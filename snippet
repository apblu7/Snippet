import javafx.animation.FadeTransition;
import javafx.animation.PauseTransition;
import javafx.application.Application;
import javafx.geometry.Pos;
import javafx.scene.Scene;
import javafx.scene.control.Button;
import javafx.scene.control.TextArea;
import javafx.scene.control.Label;
import javafx.scene.layout.StackPane;
import javafx.scene.layout.VBox;
import javafx.scene.text.Font;
import javafx.stage.Stage;
import javafx.util.Duration;
import javafx.scene.input.KeyCode;
import javafx.scene.input.Clipboard;
import javafx.scene.input.ClipboardContent;

public class Main extends Application {

    private TextArea textArea;

    public static void main(String[] args) {
        launch(args);
    }

    @Override
    public void start(Stage primaryStage) {
        textArea = new TextArea();
        textArea.setWrapText(true);
        textArea.setFont(Font.font("Malgun Gothic", 14));

        Button reloadButton = new Button("조회");
        reloadButton.setOnAction(e -> reloadAndNotify());

        VBox content = new VBox(10, textArea, reloadButton);
        content.setAlignment(Pos.CENTER);
        content.setStyle("-fx-padding: 20px;");

        StackPane root = new StackPane(content);
        Scene scene = new Scene(root, 800, 600);

        // F5 키 이벤트
        scene.setOnKeyPressed(event -> {
            if (event.getCode() == KeyCode.F5) {
                reloadAndNotify();
            }
        });

        primaryStage.setScene(scene);
        primaryStage.setTitle("Snippet Viewer");
        primaryStage.show();
    }

    private void reloadAndNotify() {
        String dummyText = "예제 텍스트입니다. 클립보드로 복사됨.";
        textArea.setText(dummyText);
        copyToClipboard(dummyText);
        showToast((StackPane) textArea.getScene().getRoot(), "조회 완료");
    }

    private void copyToClipboard(String text) {
        Clipboard clipboard = Clipboard.getSystemClipboard();
        ClipboardContent content = new ClipboardContent();
        content.putString(text);
        clipboard.setContent(content);
    }

    private void showToast(StackPane root, String message) {
        Label toast = new Label(message);
        toast.setStyle("-fx-background-color: black; -fx-text-fill: white; -fx-padding: 8px 16px; -fx-background-radius: 8px;");
        toast.setOpacity(1.0);

        StackPane.setAlignment(toast, Pos.BOTTOM_CENTER);
        root.getChildren().add(toast);

        PauseTransition pause = new PauseTransition(Duration.seconds(0.5));
        pause.setOnFinished(event -> {
            FadeTransition fade = new FadeTransition(Duration.seconds(0.3), toast);
            fade.setToValue(0.0);
            fade.setOnFinished(e -> root.getChildren().remove(toast));
            fade.play();
        });
        pause.play();
    }
}