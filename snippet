import java.net.URI;
import java.net.URLEncoder;
import java.nio.charset.StandardCharsets;
import java.util.LinkedHashMap;
import java.util.Map;

public class UriBuilder {
    private final String baseUrl;
    private final Map<String, Param> params = new LinkedHashMap<>();

    private static class Param {
        String value;
        boolean encode;

        Param(String value, boolean encode) {
            this.value = value;
            this.encode = encode;
        }
    }

    private UriBuilder(String baseUrl) {
        this.baseUrl = baseUrl;
    }

    public static UriBuilder from(String baseUrl) {
        return new UriBuilder(baseUrl);
    }

    public UriBuilder addParam(String key, String value, boolean encode) {
        params.put(key, new Param(value, encode));
        return this;
    }

    public URI build() {
        StringBuilder finalUrl = new StringBuilder(baseUrl);

        boolean firstParam = true;

        for (Map.Entry<String, Param> entry : params.entrySet()) {
            String key = entry.getKey();
            Param param = entry.getValue();

            String encodedValue = param.encode
                    ? URLEncoder.encode(param.value, StandardCharsets.UTF_8)
                    : param.value;

            finalUrl.append(firstParam ? "?" : "&");
            finalUrl.append(key).append("=").append(encodedValue);
            firstParam = false;
        }

        return URI.create(finalUrl.toString());
    }
}