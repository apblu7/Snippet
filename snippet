@echo off
chcp 65001 > nul
setlocal

set TARGET_BAT=C:\HUNESION\i-oneNGS\deploy-ets.bat
set LOG_FILE=C:\HUNESION\i-oneNGS\deploy-ets.log
set SNAKETAIL_EXE=C:\Tools\SnakeTail\SnakeTail.exe

if exist "%LOG_FILE%" del "%LOG_FILE%"

powershell -Command "[System.IO.File]::WriteAllText('%LOG_FILE%', '', [System.Text.Encoding]::UTF8)"

rem SnakeTail을 자식 프로세스로 실행
"%SNAKETAIL_EXE%" -f "%LOG_FILE%" &
set SNAKETAIL_PID=%!

rem 배치파일 실행
call "%TARGET_BAT%" >> "%LOG_FILE%" 2>&1

echo.
echo [INFO] 배치 종료됨. SnakeTail 종료 처리 중...

rem SnakeTail 강제 종료
taskkill /f /im SnakeTail.exe > nul 2>&1

pause