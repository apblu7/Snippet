@echo off
setlocal

rem local
set PROJECT_NAME=ets_test
set SERVER=ubuntu@10.110.30.50
set KEY_PATH=%~dp0.\server_key.ppk
set WINSCP="C:\HUNESION\i-oneNGS\WinSCP.exe"
set WAR_FILE=%PROJECT_NAME%.war
set WAR_PATH=%~dp0..\target\

rem remote
set REMOTE_UPLOAD_DIR=/home/ubuntu
set REMOTE_BACKUP_PATH=/home/ubuntu/deploy
set REMOTE_DEPLOY_PATH=/opt/apache-tomcat-9.0.89/webapps

echo Step1. WAR 파일을 서버로 업로드합니다.
%WINSCP% /console /command ^
    "open sftp://%SERVER%/ -privatekey=%KEY_PATH%" ^
    "put ""%WAR_PATH%%WAR_FILE%"" %REMOTE_UPLOAD_DIR%/" ^
    "exit"
if %errorlevel% neq 0 (
    echo [오류] 파일 업로드에 실패했습니다. errorlevel=%errorlevel%
    pause
    exit /b %errorlevel%
)
pause