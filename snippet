@Component
public class HeaderValidationAdvice {

    private final Properties authProperties;

    public HeaderValidationAdvice(@Qualifier("authHeaderProperties") Properties authProperties) {
        this.authProperties = authProperties;
    }

    @ModelAttribute
    public void validateHeader(HttpServletRequest request, HandlerMethod handlerMethod) {
        String controller = handlerMethod.getBeanType().getSimpleName();
        String method = handlerMethod.getMethod().getName();
        String keyId = "user-key"; // 예시

        String headerValue = request.getHeader(keyId);
        String expectedValue = authProperties.getProperty(controller + "." + method + "." + keyId);

        if (!Objects.equals(headerValue, expectedValue)) {
            throw new ResponseStatusException(HttpStatus.FORBIDDEN, "인증 실패");
        }
    }
}